sudo -u www-data bash -c "source venv/bin/activate && python debug_openai_onpremise.py"
ENV_LOADER: Carregadas variÃ¡veis de .env
============================================================
ğŸ” DEBUG OPENAI ON-PREMISE
============================================================
ğŸ“… 22/07/2025 14:01:01

ğŸ“‹ VariÃ¡veis de ambiente...
ğŸŒ Debugando variÃ¡veis de ambiente...
âš ï¸ OPENAI_API_KEY nÃ£o encontrada no ambiente
âœ… DATABASE_URL: configurada
âœ… SESSION_SECRET: configurada
âš ï¸ CRYPTO_KEY: nÃ£o configurada

ğŸ“‹ Sistema de criptografia...
ğŸ” Debugando sistema de criptografia...
âŒ Erro no sistema de criptografia: cannot import name 'Usuario' from partially initialized module 'models.usuario' (most likely due to a circular import) (/var/www/assessment/models/usuario.py)

ğŸ“‹ Sistema de parÃ¢metros...
ğŸ” Debugando sistema de parÃ¢metros...
INFO:root:Blueprint de projetos registrado com sucesso
INFO:root:Blueprint de assessments registrado com sucesso
INFO:root:Blueprint de parÃ¢metros registrado com sucesso
INFO:root:Portal do cliente registrado com sucesso
INFO:root:ConfiguraÃ§Ãµes padrÃ£o inicializadas
INFO:root:Blueprint de projetos registrado com sucesso
INFO:root:Blueprint de assessments registrado com sucesso
INFO:root:Blueprint de parÃ¢metros registrado com sucesso
INFO:root:Portal do cliente registrado com sucesso
INFO:root:ConfiguraÃ§Ãµes padrÃ£o inicializadas
âœ… ParÃ¢metro 'openai_api_key' encontrado no banco
   Tipo: encrypted
   Tem valor criptografado: True
   Tem valor normal: False
   Data atualizaÃ§Ã£o: 2025-07-22 13:41:42.392372
DEBUG:root:OpenAI API key descriptografada com sucesso. Tamanho: 164
DEBUG:root:OpenAI API key format check: starts_with_sk=True
   Valor descriptografado: sk-proj-qj...tuH6IA (tamanho: 164)
   âœ… Chave tem formato correto (sk-)
   âœ… Chave tem tamanho adequado

ğŸ“‹ ConfiguraÃ§Ã£o OpenAI...
ğŸ¤– Debugando configuraÃ§Ã£o OpenAI...
âŒ Erro ao verificar configuraÃ§Ã£o OpenAI: Working outside of application context.

This typically means that you attempted to use functionality that needed
the current application. To solve this, set up an application context
with app.app_context(). See the documentation for more information.

ğŸ“‹ Cliente OpenAI...
ğŸ”— Debugando cliente OpenAI...
ERROR:root:Erro ao inicializar cliente OpenAI: Working outside of application context.

This typically means that you attempted to use functionality that needed
the current application. To solve this, set up an application context
with app.app_context(). See the documentation for more information.
âŒ OpenAI Assistant NÃƒO configurado

============================================================
ğŸ“Š RELATÃ“RIO FINAL
============================================================
âœ… VerificaÃ§Ãµes OK: 1/5
   âŒ VariÃ¡veis de ambiente
   âŒ Sistema de criptografia
   âœ… Sistema de parÃ¢metros
   âŒ ConfiguraÃ§Ã£o OpenAI
   âŒ Cliente OpenAI

ğŸ”§ PROBLEMAS IDENTIFICADOS:
   ğŸ“ Verificar se a chave OpenAI Ã© vÃ¡lida e ativa
   ğŸ“ Testar a chave em: https://platform.openai.com/playground
============================================================
root@templateubuntu:/var/www/assessment# cd /var/www/assessment
sudo -u www-data bash -c "source venv/bin/activate && python fix_openai_key_onpremise.py"
ENV_LOADER: Carregadas variÃ¡veis de .env
============================================================
ğŸ”§ CORREÃ‡ÃƒO DA CHAVE OPENAI ON-PREMISE
============================================================
ğŸ“… 22/07/2025 14:01:11

Este script vai:
1. Limpar configuraÃ§Ã£o OpenAI atual
2. Reconfigurar com nova chave
3. Testar a configuraÃ§Ã£o

Continuar? (s/N): s

ğŸ§¹ Limpando configuraÃ§Ã£o OpenAI atual...
INFO:root:Blueprint de projetos registrado com sucesso
INFO:root:Blueprint de assessments registrado com sucesso
INFO:root:Blueprint de parÃ¢metros registrado com sucesso
INFO:root:Portal do cliente registrado com sucesso
INFO:root:ConfiguraÃ§Ãµes padrÃ£o inicializadas
INFO:root:Blueprint de projetos registrado com sucesso
INFO:root:Blueprint de assessments registrado com sucesso
INFO:root:Blueprint de parÃ¢metros registrado com sucesso
INFO:root:Portal do cliente registrado com sucesso
INFO:root:ConfiguraÃ§Ãµes padrÃ£o inicializadas
âœ… Removido parÃ¢metro: openai_api_key
âœ… Removido parÃ¢metro: openai_assistant_name
âœ… ConfiguraÃ§Ã£o OpenAI limpa

ğŸ”§ Reconfigurando OpenAI...
ğŸ“ Cole sua chave OpenAI aqui (deve comeÃ§ar com sk-)
ğŸ’¡ VocÃª pode obter uma em: https://platform.openai.com/api-keys

Chave OpenAI: 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
Nome do Assistant (opcional, pressione Enter para padrÃ£o): asst_HMYchoc6I6hHowb8UUqssl4l
INFO:root:Blueprint de projetos registrado com sucesso
INFO:root:Blueprint de assessments registrado com sucesso
INFO:root:Blueprint de parÃ¢metros registrado com sucesso
INFO:root:Portal do cliente registrado com sucesso
INFO:root:ConfiguraÃ§Ãµes padrÃ£o inicializadas
âœ… ConfiguraÃ§Ã£o OpenAI salva no banco
DEBUG:root:OpenAI API key descriptografada com sucesso. Tamanho: 164
DEBUG:root:OpenAI API key format check: starts_with_sk=True
âœ… VerificaÃ§Ã£o: chave carregada corretamente
âœ… VerificaÃ§Ã£o: chave matches

ğŸ§ª Testando chave OpenAI...
ERROR:root:Erro ao inicializar cliente OpenAI: Working outside of application context.

This typically means that you attempted to use functionality that needed
the current application. To solve this, set up an application context
with app.app_context(). See the documentation for more information.
âŒ Assistant nÃ£o configurado

============================================================
âŒ CONFIGURAÃ‡ÃƒO SALVA MAS TESTE FALHOU
============================================================
ğŸ“ Verifique se:
   - A chave estÃ¡ correta
   - A conta OpenAI estÃ¡ ativa
   - HÃ¡ crÃ©ditos/billing configurado
   - NÃ£o hÃ¡ problemas de rede
============================================================
