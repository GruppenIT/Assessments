root@templateubuntu:/var/www/assessment# sudo bash -c "source venv/bin/activate && python fix_supervisor_config.py"
============================================================
ğŸ”§ CORREÃ‡ÃƒO CONFIGURAÃ‡ÃƒO SUPERVISOR
============================================================
ğŸ“… 2025-07-22 13:27:35

ğŸ“ Corrigindo /etc/supervisor/conf.d/assessment.conf
ğŸ“„ ConteÃºdo atual:
[program:assessment]
command=/var/www/assessment/venv/bin/gunicorn --bind 127.0.0.1:5000 --workers 3 --timeout 300 --worker-class sync main:app
directory=/var/www/assessment
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/assessment.log
stderr_logfile=/var/log/supervisor/assessment_error.log
environment=DATABASE_URL="postgresql://assessment_user:P%40ssw0rd%40.!@localhost/assessment_db",SESSION_SECRET="9JUijS0Z9csNkHM2ssAXXirRPsW0MSA3Ax1yACVWqxs=",FLASK_SECRET_KEY="9JUijS0Z9csNkHM2ssAXXirRPsW0MSA3Ax1yACVWqxs=",FLASK_ENV="production"


==================================================

ğŸ’¾ Backup criado: /etc/supervisor/conf.d/assessment.conf.backup_fix.20250722_132735
ğŸ“ Nova configuraÃ§Ã£o:
[program:assessment]
command=/var/www/assessment/venv/bin/gunicorn --bind 0.0.0.0:8000 --workers 3 --timeout 120 main:app
directory=/var/www/assessment
user=www-data
autostart=true
autorestart=true
environment=DATABASE_URL="postgresql://assessment_user:P%40ssw0rd%40.!@localhost/assessment_db",SESSION_SECRET="9JUijS0Z9csNkHM2ssAXXirRPsW0MSA3Ax1yACVWqxs=",FLASK_SECRET_KEY="9JUijS0Z9csNkHM2ssAXXirRPsW0MSA3Ax1yACVWqxs=",FLASK_ENV="production",TZ="America/Sao_Paulo"
stdout_logfile=/var/log/assessment.log
stderr_logfile=/var/log/assessment_error.log
redirect_stderr=true


==================================================

âœ… ConfiguraÃ§Ã£o corrigida!

ğŸ”„ Reiniciando supervisor...
   ğŸ“¡ sudo supervisorctl reread
ERROR: CANT_REREAD: Format string 'DATABASE_URL="postgresql://assessment_user:P%40ssw0rd%40.!@localhost/assessment_db",SESSION_SECRET="9JUijS0Z9csNkHM2ssAXXirRPsW0MSA3Ax1yACVWqxs=",FLASK_SECRET_KEY="9JUijS0Z9csNkHM2ssAXXirRPsW0MSA3Ax1yACVWqxs=",FLASK_ENV="production",TZ="America/Sao_Paulo"' for 'environment' is badly formatted: not enough arguments for format string in section 'program:assessment' (file: '/etc/supervisor/conf.d/assessment.conf')
   âš ï¸  CÃ³digo de saÃ­da: 256
   ğŸ“¡ sudo supervisorctl update
error: <class 'xmlrpc.client.Fault'>, <Fault 92: 'CANT_REREAD: Format string \'DATABASE_URL="postgresql://assessment_user:P%40ssw0rd%40.!@localhost/assessment_db",SESSION_SECRET="9JUijS0Z9csNkHM2ssAXXirRPsW0MSA3Ax1yACVWqxs=",FLASK_SECRET_KEY="9JUijS0Z9csNkHM2ssAXXirRPsW0MSA3Ax1yACVWqxs=",FLASK_ENV="production",TZ="America/Sao_Paulo"\' for \'environment\' is badly formatted: not enough arguments for format string in section \'program:assessment\' (file: \'/etc/supervisor/conf.d/assessment.conf\')'>: file: /usr/lib/python3.12/xmlrpc/client.py line: 668
   âš ï¸  CÃ³digo de saÃ­da: 256
   ğŸ“¡ sudo supervisorctl restart assessment
assessment: stopped
assessment: started
   âœ… Sucesso

============================================================
âœ… CONFIGURAÃ‡ÃƒO CORRIGIDA
ğŸ”„ Aguarde alguns segundos para o serviÃ§o inicializar
============================================================
root@templateubuntu:/var/www/assessment# sudo bash -c "source venv/bin/activate && python fix_supervisor_config.py"^C
root@templateubuntu:/var/www/assessment# sudo bash -c "source venv/bin/activate && python test_database_connection.py"
============================================================
ğŸ§ª TESTE DE CONEXÃƒO COM BANCO
============================================================
ğŸ§ª Testando configuraÃ§Ã£o da aplicaÃ§Ã£o...
INFO:root:Blueprint de projetos registrado com sucesso
INFO:root:Blueprint de assessments registrado com sucesso
INFO:root:Blueprint de parÃ¢metros registrado com sucesso
INFO:root:Portal do cliente registrado com sucesso
INFO:root:ConfiguraÃ§Ãµes padrÃ£o inicializadas
INFO:root:Blueprint de projetos registrado com sucesso
INFO:root:Blueprint de assessments registrado com sucesso
INFO:root:Blueprint de parÃ¢metros registrado com sucesso
INFO:root:Portal do cliente registrado com sucesso
INFO:root:ConfiguraÃ§Ãµes padrÃ£o inicializadas
   ğŸ”— DATABASE_URI: sqlite:///assessment.db
   âŒ AplicaÃ§Ã£o ainda usando SQLite: sqlite:///assessment.db

============================================================
âŒ AINDA HÃ PROBLEMAS NA CONFIGURAÃ‡ÃƒO
============================================================
root@templateubuntu:/var/www/assessment#
